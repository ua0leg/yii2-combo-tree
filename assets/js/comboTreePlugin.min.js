/*! * jQuery ComboTree Plugin * Author: Erhan FIRAT * Mail: erhanfirat@gmail.com * Licensed under the MIT license * Version: 1.2.1 */
!function(e,t,o,s){var n="comboTree",r={source:[],isMultiple:!1,cascadeSelect:!1,selected:[],collapse:!1,selectableLastNode:!1};function l(t,o){this.options=e.extend({},r,o),this._defaults=r,this._name=n,this.constructorFunc(t,o)}l.prototype.constructorFunc=function(t,o){this.elemInput=t,this._elemInput=e(t),this.init()},l.prototype.init=function(){this.comboTreeId="comboTree"+Math.floor(999999*Math.random()),this._elemInput.addClass("comboTreeInputBox"),this._elemInput.attr("id")===s&&this._elemInput.attr("id",this.comboTreeId+"Input"),this.elemInputId=this._elemInput.attr("id"),this._elemInput.wrap('<div id="'+this.comboTreeId+'Wrapper" class="comboTreeWrapper"></div>'),this._elemInput.wrap('<div id="'+this.comboTreeId+'InputWrapper" class="comboTreeInputWrapper"></div>'),this._elemWrapper=e("#"+this.comboTreeId+"Wrapper"),this._elemArrowBtn=e('<div id="'+this.comboTreeId+'ArrowBtn" class="comboTreeArrowBtn" type="button"><span class="mdi mdi-chevron-down comboTreeArrowBtnImg"></span></div>'),this._elemInput.after(this._elemArrowBtn),this._elemWrapper.append('<div id="'+this.comboTreeId+'DropDownContainer" class="comboTreeDropDownContainer"><div class="comboTreeDropDownContent"></div>'),this._elemDropDownContainer=e("#"+this.comboTreeId+"DropDownContainer"),this._elemDropDownContainer.html(this.createSourceHTML()),this._elemFilterInput=this.options.isMultiple?e("#"+this.comboTreeId+"MultiFilter"):null,this._elemSourceUl=e("#"+this.comboTreeId+"ComboTreeSourceUl"),this._elemItems=this._elemDropDownContainer.find("li"),this._elemItemsTitle=this._elemDropDownContainer.find("span.comboTreeItemTitle"),this._selectedItem={},this._selectedItems=[],this.processSelected(),this.bindings()},l.prototype.unbind=function(){this._elemArrowBtn.off("click"),this._elemInput.off("click"),this._elemItems.off("click"),this._elemItemsTitle.off("click"),this._elemItemsTitle.off("mousemove"),this._elemInput.off("keyup"),this._elemInput.off("keydown"),this._elemInput.off("mouseup."+this.comboTreeId),e(o).off("mouseup."+this.comboTreeId)},l.prototype.destroy=function(){this.unbind(),this._elemWrapper.before(this._elemInput),this._elemWrapper.remove()},l.prototype.removeSourceHTML=function(){this._elemDropDownContainer.html("")},l.prototype.createSourceHTML=function(){var e="";return this.options.isMultiple&&(e=this.createFilterHTMLForMultiSelect()),e+=this.createSourceSubItemsHTML(this.options.source)},l.prototype.createFilterHTMLForMultiSelect=function(){return'<input id="'+this.comboTreeId+'MultiFilter" type="text" class="multiplesFilter" placeholder="..."/>'},l.prototype.createSourceSubItemsHTML=function(e,t,o=!1){for(var i='<UL id="'+this.comboTreeId+"ComboTreeSourceUl"+(t||"main")+'" style="'+((this.options.collapse||o)&&t?"display:none;":"")+'">',s=0;s<e.length;s++)i+=this.createSourceItemHTML(e[s]);return i+="</UL>"},l.prototype.createSourceItemHTML=function(e){var t="",o=e.hasOwnProperty("subs"),i=!!e.hasOwnProperty("collapse")&&e.hasOwnProperty("collapse");let n=e.isSelectable===s||e.isSelectable,r=n||o?"selectable":"not-selectable",l=!(this.options.selectableLastNode===s||!o)&&this.options.selectableLastNode;return t+='<LI id="'+this.comboTreeId+"Li"+e.id+'" class="ComboTreeItem'+(o?"Parent":"Chlid")+'"> ',o&&(t+='<span class="comboTreeParentPlus">'+(this.options.collapse||i?'<span class="mdi mdi-chevron-right-circle-outline"></span>':'<span class="mdi mdi-chevron-down-circle-outline"></span>')+"</span>"),this.options.isMultiple?t+='<span data-id="'+e.id+'" data-selectable="'+n+'" class="comboTreeItemTitle '+r+'">'+(!l&&n?'<input type="checkbox" />':"")+e.title+"</span>":t+='<span data-id="'+e.id+'" data-selectable="'+n+'" class="comboTreeItemTitle '+r+'">'+e.title+"</span>",o&&(t+=this.createSourceSubItemsHTML(e.subs,e.id,i)),t+="</LI>"},l.prototype.bindings=function(){var t=this;e(this._elemInput).focus((function(o){t._elemDropDownContainer.is(":visible")||e(t._elemDropDownContainer).slideToggle(100)})),this._elemArrowBtn.on("click",(function(e){e.stopPropagation(),t.toggleDropDown()})),this._elemInput.on("click",(function(e){e.stopPropagation(),t._elemDropDownContainer.is(":visible")||t.toggleDropDown()})),this._elemItems.on("click",(function(o){o.stopPropagation(),e(this).hasClass("ComboTreeItemParent")&&t.toggleSelectionTree(this)})),this._elemItemsTitle.on("click",(function(e){e.stopPropagation(),t.options.isMultiple?t.multiItemClick(this):t.singleItemClick(this)})),this._elemItemsTitle.on("mousemove",(function(e){e.stopPropagation(),t.dropDownMenuHover(this)})),this._elemInput.on("keyup",(function(e){switch(e.stopPropagation(),e.keyCode){case 27:t.closeDropDownMenu();break;case 13:case 39:case 37:case 40:case 38:e.preventDefault();break;default:t.options.isMultiple||t.filterDropDownMenu()}})),this._elemFilterInput&&this._elemFilterInput.on("keyup",(function(o){switch(o.stopPropagation(),o.keyCode){case 27:e(this).val()?(e(this).val(""),t.filterDropDownMenu()):t.closeDropDownMenu();break;case 40:case 38:o.preventDefault(),t.dropDownInputKeyControl(o.keyCode-39);break;case 37:case 39:o.preventDefault(),t.dropDownInputKeyToggleTreeControl(o.keyCode-38);break;case 13:t.multiItemClick(t._elemHoveredItem),o.preventDefault();break;default:t.filterDropDownMenu()}})),this._elemInput.on("keydown",(function(e){switch(e.stopPropagation(),e.keyCode){case 9:t.closeDropDownMenu();break;case 40:case 38:e.preventDefault(),t.dropDownInputKeyControl(e.keyCode-39);break;case 37:case 39:e.preventDefault(),t.dropDownInputKeyToggleTreeControl(e.keyCode-38);break;case 13:t.options.isMultiple?t.multiItemClick(t._elemHoveredItem):t.singleItemClick(t._elemHoveredItem),e.preventDefault();break;default:t.options.isMultiple&&e.preventDefault()}})),e(o).on("mouseup."+t.comboTreeId,(function(e){!t._elemWrapper.is(e.target)&&0===t._elemWrapper.has(e.target).length&&t._elemDropDownContainer.is(":visible")&&t.closeDropDownMenu()}))},l.prototype.toggleDropDown=function(){let t=this;e(this._elemDropDownContainer).slideToggle(100,(function(){t._elemDropDownContainer.is(":visible")&&e(t._elemInput).focus()}))},l.prototype.closeDropDownMenu=function(){e(this._elemDropDownContainer).slideUp(100)},l.prototype.toggleSelectionTree=function(t,o){var i=e(t).children("ul")[0];o===s?(e(i).is(":visible")?e(t).children("span.comboTreeParentPlus").html('<span class="mdi mdi-chevron-right-circle-outline"></span>'):e(t).children("span.comboTreeParentPlus").html('<span class="mdi mdi-chevron-down-circle-outline"></span>'),e(i).slideToggle(50)):1!=o||e(i).is(":visible")?-1==o&&(e(i).is(":visible")?(e(t).children("span.comboTreeParentPlus").html('<span class="mdi mdi-chevron-right-circle-outline"></span>'),e(i).slideUp(50)):this.dropDownMenuHoverToParentItem(t)):(e(t).children("span.comboTreeParentPlus").html('<span class="mdi mdi-chevron-down-circle-outline"></span>'),e(i).slideDown(50))},l.prototype.selectMultipleItem=function(t){if(this.options.selectableLastNode&&e(t).parent("li").hasClass("ComboTreeItemParent"))return this.toggleSelectionTree(e(t).parent("li")),!1;if(1==e(t).data("selectable")){if(this._selectedItem={id:e(t).attr("data-id"),title:e(t).text()},this.isItemInArray(this._selectedItem,this.options.source)){var o=this.isItemInArray(this._selectedItem,this._selectedItems);o?(this._selectedItems.splice(parseInt(o),1),e(t).find("input").prop("checked",!1)):(this._selectedItems.push(this._selectedItem),e(t).find("input").prop("checked",!0))}}},l.prototype.singleItemClick=function(t){1==e(t).data("selectable")&&(this._selectedItem={id:e(t).attr("data-id"),title:e(t).text()}),this.refreshInputVal(),this.closeDropDownMenu()},l.prototype.multiItemClick=function(t){(this.selectMultipleItem(t),this.options.cascadeSelect)&&(e(t).parent("li").hasClass("ComboTreeItemParent")&&e(t).parent("li").children("ul").first().find('input[type="checkbox"]').each((function(){var o=e(this);e(t).children('input[type="checkbox"]').first().prop("checked")!==o.prop("checked")&&(o.prop("checked",!e(t).children('input[type="checkbox"]').first().prop("checked")),o.trigger("click"))})));this.refreshInputVal()},l.prototype.isItemInArray=function(e,t){for(var o=0;o<t.length;o++){if(e.id==t[o].id&&e.title==t[o].title)return o+"";if(t[o].hasOwnProperty("subs")){let i=this.isItemInArray(e,t[o].subs);if(i)return i}}return!1},l.prototype.refreshInputVal=function(){var e="";if(this.options.isMultiple)for(var t=0;t<this._selectedItems.length;t++)e+=this._selectedItems[t].title,t<this._selectedItems.length-1&&(e+=", ");else e=this._selectedItem.title;this._elemInput.val(e),this._elemInput.trigger("change"),this.changeHandler&&this.changeHandler()},l.prototype.dropDownMenuHover=function(t,o){this._elemItems.find("span.comboTreeItemHover").removeClass("comboTreeItemHover"),e(t).addClass("comboTreeItemHover"),this._elemHoveredItem=e(t),o&&this.dropDownScrollToHoveredItem(this._elemHoveredItem)},l.prototype.dropDownScrollToHoveredItem=function(t){var o=this._elemSourceUl.scrollTop();this._elemSourceUl.scrollTop(o+e(t).parent().position().top-80)},l.prototype.dropDownMenuHoverToParentItem=function(t){var o=e(e(t).parents("li.ComboTreeItemParent")[0]).children("span.comboTreeItemTitle");o.length?this.dropDownMenuHover(o,!0):this.dropDownMenuHover(this._elemItemsTitle[0],!0)},l.prototype.dropDownInputKeyToggleTreeControl=function(t){var o=this._elemHoveredItem;e(o).parent("li").hasClass("ComboTreeItemParent")?this.toggleSelectionTree(e(o).parent("li"),t):-1==t&&this.dropDownMenuHoverToParentItem(o)},l.prototype.dropDownInputKeyControl=function(e){this._elemDropDownContainer.is(":visible")||this.toggleDropDown();var t=this._elemItems.find("span.comboTreeItemTitle:visible");i=this._elemHoveredItem?t.index(this._elemHoveredItem)+e:0,i=(t.length+i)%t.length,this.dropDownMenuHover(t[i],!0)},l.prototype.filterDropDownMenu=function(){var t="";""!=(t=this.options.isMultiple?e("#"+this.comboTreeId+"MultiFilter").val():this._elemInput.val())?(this._elemItemsTitle.hide(),this._elemItemsTitle.siblings("span.comboTreeParentPlus").hide(),list=this._elemItems.filter((function(e,o){return-1!=o.innerHTML.toLowerCase().indexOf(t.toLowerCase())})).each((function(t,o){e(this.children).show(),e(this).siblings("span.comboTreeParentPlus").show()}))):(this._elemItemsTitle.show(),this._elemItemsTitle.siblings("span.comboTreeParentPlus").show())},l.prototype.processSelected=function(){let t=this._elemItemsTitle,o=this._selectedItem,i=this._selectedItems;this.options.selected.forEach((function(s){let n=e(t).filter((function(){return e(this).data("id")==s}));n.length>0&&(e(n).find("input").attr("checked",!0),o={id:n.data("id"),title:n.text()},i.push(o))})),this._selectedItem=o,this.refreshInputVal()},l.prototype.findItembyId=function(e,t){if(e&&t)for(let o=0;o<t.length;o++){if(t[o].id==e)return{id:t[o].id,title:t[o].title};if(t[o].hasOwnProperty("subs")){let i=this.findItembyId(e,t[o].subs);if(i)return i}}return null},l.prototype.getSelectedIds=function(){if(this.options.isMultiple&&this._selectedItems.length>0){var e=[];for(i=0;i<this._selectedItems.length;i++)e.push(this._selectedItems[i].id);return e}return!this.options.isMultiple&&this._selectedItem.hasOwnProperty("id")?[this._selectedItem.id]:null},l.prototype.getSelectedNames=function(){if(this.options.isMultiple&&this._selectedItems.length>0){var e=[];for(i=0;i<this._selectedItems.length;i++)e.push(this._selectedItems[i].title);return e}return!this.options.isMultiple&&this._selectedItem.hasOwnProperty("id")?this._selectedItem.title:null},l.prototype.setSource=function(e){this._selectedItems=[],this.destroy(),this.options.source=e,this.constructorFunc(this.elemInput,this.options)},l.prototype.clearSelection=function(){for(i=0;i<this._selectedItems.length;i++){let t=e("#"+this.comboTreeId+"Li"+this._selectedItems[i].id);e(t).find("input").prop("checked",!1)}this._selectedItems=[],this.refreshInputVal()},l.prototype.setSelection=function(t){if(t&&t.length&&t.length>0)for(let o=0;o<t.length;o++){let i=this.findItembyId(t[o],this.options.source);if(i){if(this.isItemInArray(i,this.options.source))if(!this.isItemInArray(i,this._selectedItems)){let s=e("#"+this.comboTreeId+"Li"+t[o]);this._selectedItems.push(i),this._selectedItem=i,e(s).find("input").prop("checked",!0)}}}this.refreshInputVal()},l.prototype.onChange=function(e){e&&"function"==typeof e&&(this.changeHandler=e)},e.fn.comboTree=function(t){var o=[];return this.each((function(){e.data(this,"plugin_comboTree")||(e.data(this,"plugin_comboTree",new l(this,t)),o.push(e(this).data().plugin_comboTree))})),1==this.length?o[0]:o}}(jQuery,window,document);
//# sourceMappingURL=comboTreePlugin.min.js.map
